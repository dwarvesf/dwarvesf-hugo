<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Docker với Microcontainers &mdash; Dwarves Foundation</title>

    <link rel="stylesheet" href="/css/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/logo.png"/>
    <link href="http://localhost:1313/index.xml" rel="alternate" type="application/rss+xml" title="Dwarves Foundation" />
    <meta name="title" content="http://localhost:1313/">
    <link rel="canonical" href="http://localhost:1313/">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Docker với Microcontainers"/>
    <meta property="og:url" content="http://localhost:1313/post/tiny-container/"/>
    <meta property="og:image" content="http://localhost:1313/images/2016-02-04-tiny-container.png"/>   
    <meta property="og:site_name" content="Dwarves Foundation">
    <meta property="og:description" content="Các docker image như node, go, ... với nhiều tool được cài đặt sẵn bên trong dẫn đến dung lượng quá lớn và có vẻ như không cần thiết cho việc deploy project của chúng ta.">
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="/">
                <img src="/images/logo.png" alt="Inc">
            </a>
            <a href="/" class="home">Blog</a>
            
            <a href="http://dwarvesf.com/">About</a>
        </nav>
        <nav class="tagline">
            
            
        </nav>
    </header>
</section>



<div class="article-cover">
    <div>
        <img src="/images/2016-02-04-tiny-container.png" class="image">
    </div>
</div>

<article>

    <div class="container">
        <header>
            <div class="meta">
                By <address><a rel="author" href="https://www.facebook.com/ivkeanle" title="Iv Kean" target="_blank">Iv Kean</a></address> &mdash;
                <time pubdate datetime="2016-02-04" title="2016-02-04">February 04, 2016</time>
            </div>
            <h1 class="title">Docker với Microcontainers</h1>
            <h2 class="subtitle">Containers are awesome. Microcontainers are awesomer.</h2>
        </header>

        <section>
            

<ul>
<li><p>Khi sử dụng docker, bạn sẽ nhanh chóng nhận ra image dùng để chạy project chiếm 1 dung lượng không nhỏ. Một image ubuntu đơn thuần cũng đã sử dụng gần 200mb nhưng bạn lại không sử dụng hết các tool có sẵn của nó. Các image khác như node, go, &hellip; cũng đa phần chạy trên nền ubuntu, debian và chỉ cài đặt thêm môi trường để bạn dễ dàng deploy hơn nhưng việc download 1 image mới trở nên tốn thời gian vì dung lượng quá lớn và có vẻ như không cần thiết.</p></li>

<li><p>Chính vì thế, tôi đã tìm ra được 1 image mà trong đó không có gì cả, theo đúng nghĩa đen là không có gì cả :D, trừ 1 số metadata được thêm vào bởi Docker.</p></li>
</ul>

<pre><code>docker pull scratch
</code></pre>

<ul>
<li>Vì vậy, có thể nói, đây là Docker image có dung lượng nhỏ nhất.</li>
</ul>

<h2 id="chúng-ta-sẽ-tìm-hiểu-cách-deploy-1-app-web-với-image-này-ngay-bây-giờ-d:ae448018aa58d317917706c6bc9942d4">Chúng ta sẽ tìm hiểu cách deploy 1 app web với image này ngay bây giờ :D</h2>

<ul>
<li><p>Tôi sẽ demo với beego web.</p></li>

<li><p>Tôi không thể compile app go trong image empty này vì nó không có Go complier. Và vì đang sử dụng Mac nên tôi không thể compile 1 Linux binary. (Thực tế là chúng ta hoàn toàn có thể cross-compile nhưng tôi sẽ không đề cập ở bài viết này. Bạn có thể tham khảo tại <a target="_blank" href="https://golang.org/doc/install/source#environment">đây</a>).</p></li>

<li><p>Vì thế tôi cần tạo 1 môi trường để compile và docker build source Go:</p></li>
</ul>

<pre><code>docker run --rm -it -v &quot;$GOPATH&quot;:/go  -e &quot;GOPATH=/go&quot;  -v /var/run/docker.sock:/var/run/docker.sock -v $(which docker):$(which docker) golang bash
</code></pre>

<ul>
<li><p>Với lệnh ở trên, <code>--rm</code> sẽ xóa container sau khi exit, <code>-v &quot;$GOPATH&quot;:/go</code> share directory GOPATH của máy với container, <code>-e &quot;GOPATH=/go&quot;</code>, <code>-v /var/run/docker.sock:/var/run/docker.sock</code> dùng để chạy đc docker bên trong container (docker trong docker :D), <code>-v $(which docker):$(which docker)</code> dùng để share command docker, golang là image môi trường để build Go binary và build image, bash để bắt đầu Bash session.</p></li>

<li><p>Lúc này, vì đã vào bên trong container nên tôi cd đến project <code>/go/src/git.dwarvesf.com/ivkean/web</code>.</p></li>

<li><p>Tạo 1 Dockerfile với nội dung như sau:</p></li>
</ul>

<pre><code># scratch
FROM scratch

WORKDIR /web

# copy binary into image
COPY web web

# copy other necessary files
COPY conf conf
COPY static static
COPY views views

EXPOSE 8080

ENTRYPOINT [&quot;/web/web&quot;]
</code></pre>

<ul>
<li><p>Build source bằng lệnh: <code>go build</code></p></li>

<li><p>Và link library bằng: <code>CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o web .</code></p></li>

<li><p>Build với docker: <code>docker build -t beego-web .</code></p></li>
</ul>

<p>
<figure class="third right">
    
        <img src="/images/2016-02-04-tiny-container-docker-build.png"  />
    
    
</figure>

</p>

<ul>
<li>Image vừa tạo chỉ chiếm dung lượng 17.5MB :D</li>
</ul>

<p>
<figure class="third right">
    
        <img src="/images/2016-02-04-tiny-container-run-docker-images.png"  />
    
    
</figure>

</p>

<ul>
<li>Khi đó, máy bạn đã có 1 image là beego-web, việc còn lại là:</li>
</ul>

<pre><code>docker run -d -p 8080:8080 beego-web
</code></pre>

<p>
<figure class="third right">
    
        <img src="/images/2016-02-04-tiny-container-run-bee-web.png"  />
    
    
</figure>

</p>

<ul>
<li>Chúc các bạn thành công.</li>
</ul>

            

<div class="social">
    <div>
        <a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a>
    </div>
    <div>
        <a href="https://twitter.com/share" class="twitter-share-button"  data-related="dwarvesf" data-text="Docker với Microcontainers - Containers are awesome. Microcontainers are awesomer.">Tweet</a>
    </div>
    <div>
        <div class="fb-like" data-width="150" data-layout="button_count" data-action="like" data-show-faces="true" data-send="false"></div>
    </div>
</div>

        </section>

        <footer>
            <address>
               <img src="/images/cotton.png">
                <p>Written by <strong><a rel="author" href="https://twitter.com/" title="Iv Kean" target="_blank">Iv Kean</a></strong><br>
                <span class="muted">Scouting Unit</span>
                </p>
            </address>

        </footer>

        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//dwarvesf.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

        </section>
        
    </div>
</article>

<footer class="site-footer">
    <div class="container">
        <nav>
            <a href="http://devblog.dwarvesf.com/">Dwarves Foundation</a> &middot;
            <a href="/">Blog</a> &middot;
            
            <a href="http://dwarvesf.com/">About</a>
        </nav>
        
        <nav class="social">
            
            <a href="https://twitter.com/dwarvesf" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="https://github.com/dwarvesf" title="Follow on Github" target="_blank"><i class="icon icon-github black"></i></a>
            
            
            <a href="http://facebook.com/dwarvesf" title="Follow on Facebook" target="_blank"><i class="icon icon-facebook black"></i></a>
                
            <a href="/index.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
    </div>
</footer>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<div id="fb-root"></div>

<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=1526296360976332";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58452796-1', 'auto');
  ga('send', 'pageview');

</script>





  

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

